
<Tool Name="CashFlowFeeModel">
    <Actions>
	  <Action ActionCode="Fee_Paid" ActionDisplayName="费用小计" FunctionName="RunManagedMethodByPath" SequenceNo="20">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_Fee_Paid" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="Fee_Paid" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
   <Action ActionCode="FeePayment" ActionDisplayName="计算费用偿付金额" FunctionName="RunManagedMethodByPath" SequenceNo="21">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="false" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_FeePayment" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="FeePayment" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
      <Action ActionCode="TrustPlanAccount_Total_AvailableAmt" ActionDisplayName="信托账户可分配收益" FunctionName="RunManagedMethodByPath" SequenceNo="26">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_TrustPlanAccount_Total_AvailableAmt" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="TrustPlanAccount_Total_AvailableAmt" DataType="String" Usage="" IsConfigurable="false" />
   </Action>
      <Action ActionCode="TrustPlanAccount_Principal_AvailableAmt" ActionDisplayName="本金账户可分配收益" FunctionName="RunManagedMethodByPath" SequenceNo="27">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_TrustPlanAccount_Principal_AvailableAmt" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="TrustPlanAccount_Principal_AvailableAmt" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
     <Action ActionCode="TrustPlanAccount_Interest_AvailableAmt" ActionDisplayName="收入账户可分配收益" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_TrustPlanAccount_Interest_AvailableAmt" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="TrustPlanAccount_Interest_AvailableAmt" DataType="String" Usage="" IsConfigurable="false" />
     </Action>
      <Action ActionCode="PreviousAssetDefault_Input" ActionDisplayName="往期资产违约额_Input" FunctionName="RunManagedMethodByPath" SequenceNo="9">
      <Parameter Name="IsDirectInput" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="false" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" IsDirectInput="true" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="PreviousAssetDefault_Input" DataType="String" Usage="" IsConfigurable="false" />
     </Action>
     <Action ActionCode="PreviousAssetDefault" ActionDisplayName="往期资产违约额" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_PreviousAssetDefault" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="PreviousAssetDefault" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
      <Action ActionCode="CurrentAssetDefault_Input" ActionDisplayName="当期资产违约额" FunctionName="RunManagedMethodByPath" SequenceNo="9">
      <Parameter Name="IsDirectInput" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" IsDirectInput="true" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="CurrentAssetDefault_Input" DataType="String" Usage="" IsConfigurable="false" />
     </Action>
     <Action ActionCode="Previous_Supplement_Input" ActionDisplayName="往期本金账补收入账_Input" FunctionName="RunManagedMethodByPath" SequenceNo="9">
      <Parameter Name="IsDirectInput" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="false" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" IsDirectInput="true" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="Previous_Supplement_Input" DataType="String" Usage="" IsConfigurable="false" />
     </Action>
      <Action ActionCode="Previous_Supplement" ActionDisplayName="往期本金账补收入账" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_Previous_Supplement" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="Previous_Supplement" DataType="String" Usage="" IsConfigurable="false" />
      </Action>
      <Action ActionCode="Previous_Carryover_Input" ActionDisplayName="往期收入账返本金账_Input" FunctionName="RunManagedMethodByPath" SequenceNo="9">
      <Parameter Name="IsDirectInput" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="false" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" IsDirectInput="true" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="Previous_Carryover_Input" DataType="String" Usage="" IsConfigurable="false" />
     </Action>
      <Action ActionCode="Previous_Carryover" ActionDisplayName="往期收入账返本金账" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_Previous_Carryover" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="Previous_Carryover" DataType="String" Usage="" IsConfigurable="false" />
      </Action>
      <Action ActionCode="Cumulate_Carryover" ActionDisplayName="当期收入账户应转付" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_Cumulate_Carryover" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="Cumulate_Carryover" DataType="String" Usage="" IsConfigurable="false" />
      </Action>
      <Action ActionCode="Cumulate_Supplement" ActionDisplayName="当期本金账户应补足" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" />
      <Parameter Name="TypeName" SessionParameterName="" Value="AddIn.CashflowScript.GenericBondWaterfallPlus" DataType="String" Usage="Task" />
      <Parameter Name="MethodName" SessionParameterName="" Value="CreateCashFlow" DataType="String" Usage="Task" />
      <Parameter Usage="" DataType="Int16" Value="0" SessionParameterName="CurrentPosition" Name="CurrentPosition" />
      <Parameter Usage="" DataType="String" Value="Cumulate_Supplement" SessionParameterName="" Name="CashFlowName" />
      </Action>
      <Action ActionCode="Cumulate_Carryover_Paid" ActionDisplayName="当期收入账户实转付" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" />
      <Parameter Name="TypeName" SessionParameterName="" Value="AddIn.CashflowScript.GenericBondWaterfallPlus" DataType="String" Usage="Task" />
      <Parameter Name="MethodName" SessionParameterName="" Value="CreateCashFlow" DataType="String" Usage="Task" />
      <Parameter Usage="" DataType="Int16" Value="0" SessionParameterName="CurrentPosition" Name="CurrentPosition" />
      <Parameter Usage="" DataType="String" Value="Cumulate_Carryover_Paid" SessionParameterName="" Name="CashFlowName" />
      </Action>
      <Action ActionCode="Cumulate_Supplement_Paid" ActionDisplayName="当期本金账户实补足" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" />
      <Parameter Name="TypeName" SessionParameterName="" Value="AddIn.CashflowScript.GenericBondWaterfallPlus" DataType="String" Usage="Task" />
      <Parameter Name="MethodName" SessionParameterName="" Value="CreateCashFlow" DataType="String" Usage="Task" />
      <Parameter Usage="" DataType="Int16" Value="0" SessionParameterName="CurrentPosition" Name="CurrentPosition" />
      <Parameter Usage="" DataType="String" Value="Cumulate_Supplement_Paid" SessionParameterName="" Name="CashFlowName" />
      </Action>
      <Action ActionCode="ChinaBondFee" ActionDisplayName="代理机构报酬" FunctionName="RunManagedMethodByPath" SequenceNo="28">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" />
      <Parameter Name="TypeName" SessionParameterName="" Value="AddIn.CashflowScript.GenericBondWaterfallPlus" DataType="String" Usage="Task" />
      <Parameter Name="MethodName" SessionParameterName="" Value="CreateCashFlow" DataType="String" Usage="Task" />
      <Parameter Usage="" DataType="Int16" Value="0" SessionParameterName="CurrentPosition" Name="CurrentPosition" />
      <Parameter Usage="" DataType="String" Value="ChinaBondFee" SessionParameterName="" Name="CashFlowName" />
    </Action>
</Actions>
<Methods>
    <main>
	 <Parameters>
	  </Parameters>
    <Query name="EC_Fee_Paid">
	    return 0;
    </Query> <Presentation />
  </main>
  <main>
    <Parameters>
    </Parameters>
    <Query name="EC_FeePayment">
     var feeSequence = (string)sContextArray["FeePaymentSequence"][CurrentPosition.ToString()];
     var feeList = Regex.Replace(feeSequence, @" ", "").Split(new string[]{";"}, StringSplitOptions.RemoveEmptyEntries).ToArray();
     for (var i = 0; i &lt; feeList.Length; i++)
           {    
     var fee = feeList[i].Split(new string[]{","},StringSplitOptions.RemoveEmptyEntries).ToArray();
         if (fee.Length &gt;= 1)
             {
               var feeName = fee[1];
                    // to do
             if(fee[2] == "false")
			 {
	  var feePaid=Math.Min(cashflows[feeName][CurrentPosition],cashflows["TrustPlanAccount_Summary"][CurrentPosition]);
      cashflows[feeName][CurrentPosition]=feePaid;
      cashflows["Fee_Paid"][CurrentPosition]=cashflows["Fee_Paid"][CurrentPosition]+feePaid;
      cashflows["TrustPlanAccount_Summary"][CurrentPosition]=cashflows["TrustPlanAccount_Summary"][CurrentPosition]-feePaid;
      cashflows["TrustPlanAccount_Interest_Summary"][CurrentPosition]=cashflows["TrustPlanAccount_Interest_Summary"][CurrentPosition]-feePaid;
      cashflows["TrustPlanAccount_Principal_Summary"][CurrentPosition]=cashflows["TrustPlanAccount_Summary"][CurrentPosition]-Math.Max(cashflows["TrustPlanAccount_Interest_Summary"][CurrentPosition],0);
			 }
           }
      }
    return 0;
</Query> <Presentation />
  </main>
   <main>
      <Parameters>
        <Parameter Name="PreviousAssetDefault" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="PreviousAssetDefault">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
	   <Parameter Name="CurrentAssetDefault_Input" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="CurrentAssetDefault_Input">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
		<Parameter Name="Previous_Supplement" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Previous_Supplement">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
		<Parameter Name="Previous_Carryover" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Previous_Carryover">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_Cumulate_Carryover">  
	 return PreviousAssetDefault+CurrentAssetDefault_Input+Previous_Supplement-Previous_Carryover;  
      </Query>
      <Presentation />
    </main>
   <main>
      <Parameters>
        <Parameter Name="Previous_Carryover_Input" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Previous_Carryover_Input">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
		<Parameter Name="Pre_Previous_Carryover" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Previous_Carryover">
            <Position>Math.Max(CurrentPosition-1,0)</Position>
          </Field>
        </Parameter>
		<Parameter Name="Pre_Cumulate_Carryover_Paid" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Cumulate_Carryover_Paid">
            <Position>Math.Max(CurrentPosition-1,0)</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_Previous_Carryover">  
	   if (Previous_Carryover_Input==0)
        {
            if (CurrentPosition==0)
             {
               return 0;
             }
             else
            {
             return Pre_Previous_Carryover+Pre_Cumulate_Carryover_Paid;
             }       
        }
        else
        {
        return Previous_Carryover_Input;
        }
      </Query>
      <Presentation />
    </main>
    <main>
      <Parameters>
        <Parameter Name="Previous_Supplement_Input" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Previous_Supplement_Input">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
		<Parameter Name="Pre_Previous_Supplement" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Previous_Supplement">
            <Position>Math.Max(CurrentPosition-1,0)</Position>
          </Field>
        </Parameter>
		<Parameter Name="Pre_Cumulate_Supplement_Paid" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Cumulate_Supplement_Paid">
            <Position>Math.Max(CurrentPosition-1,0)</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_Previous_Supplement">  
	   if (Previous_Supplement_Input==0)
        {
            if (CurrentPosition==0)
             {
               return 0;
             }
             else
            {
             return Pre_Previous_Supplement+Pre_Cumulate_Supplement_Paid;
             }       
        }
        else
        {
        return Previous_Supplement_Input;
        }
      </Query>
      <Presentation />
    </main>
     <main>
      <Parameters>
        <Parameter Name="PreviousAssetDefault_Input" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="PreviousAssetDefault_Input">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
		<Parameter Name="Pre_PreviousAssetDefault" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="PreviousAssetDefault">
            <Position>Math.Max(CurrentPosition-1,0)</Position>
          </Field>
        </Parameter>
		<Parameter Name="Pre_CurrentAssetDefault_Input" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="CurrentAssetDefault_Input">
            <Position>Math.Max(CurrentPosition-1,0)</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_PreviousAssetDefault">
	      if (PreviousAssetDefault_Input==0)
        {
            if (CurrentPosition==0)
             {
               return 0;
             }
             else
            {
             return Pre_PreviousAssetDefault+Pre_CurrentAssetDefault_Input;
             }       
        }
        else
        {
        return PreviousAssetDefault_Input;
        }
      </Query>
      <Presentation />
    </main>
    <main>
      <Parameters>
        <Parameter Name="TrustPlanAccount_Interest_Summary" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="TrustPlanAccount_Interest_Summary">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_TrustPlanAccount_Interest_AvailableAmt">
        return TrustPlanAccount_Interest_Summary;
      </Query>
      <Presentation />
    </main>
    <main>
      <Parameters>
        <Parameter Name="TrustPlanAccount_Summary" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="TrustPlanAccount_Summary">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_TrustPlanAccount_Total_AvailableAmt">
        return TrustPlanAccount_Summary;
      </Query>
      <Presentation />
    </main>
	<main>
      <Parameters>
        <Parameter Name="TrustPlanAccount_Principal_Summary" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="TrustPlanAccount_Principal_Summary">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_TrustPlanAccount_Principal_AvailableAmt">
        return TrustPlanAccount_Principal_Summary;
      </Query>
      <Presentation />
    </main>
  </Methods>
</Tool>