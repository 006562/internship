<Tool Name="CashFlowAllocationBondPaidModel">
   <Actions>
      <Action ActionCode="ClosingBalance_#level#_#Id#" ActionDisplayName="#{ShortName}#期末本金余额" FunctionName="RunManagedMethodByPath" SequenceNo="69">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_ClosingInvestedAmount_#level#_#Id#" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="ClosingBalance_#level#_#Id#" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
	 <Action ActionCode="InterestLeftover_#level#_#Id#" ActionDisplayName="#{ShortName}#利息未付结余" FunctionName="RunManagedMethodByPath" SequenceNo="69">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_InterestLeftover_#level#_#Id#" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="InterestLeftover_#level#_#Id#" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
    <Action ActionCode="CouponPaymentPerNote_#level#_#Id#" ActionDisplayName="#{ShortName}#每份分配利息" FunctionName="RunManagedMethodByPath" SequenceNo="70">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_CouponPaymentPerNote_#level#_#Id#" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="CouponPaymentPerNote_#level#_#Id#" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
    <Action ActionCode="PrincipalPaymentPerNote_#level#_#Id#" ActionDisplayName="#{ShortName}#每份分配本金" FunctionName="RunManagedMethodByPath" SequenceNo="71">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_PrincipalPaymentPerNote_#level#_#Id#" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="PrincipalPaymentPerNote_#level#_#Id#" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
    <Action ActionCode="TotalPaymentPerNote_#level#_#Id#" ActionDisplayName="#{ShortName}#每份总分配" FunctionName="RunManagedMethodByPath" SequenceNo="72">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_TotalPaymentPerNote_#level#_#Id#" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="TotalPaymentPerNote_#level#_#Id#" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
    <Action ActionCode="TotalBondPayment_#level#_#Id#" ActionDisplayName="#{ShortName}#总分配" FunctionName="RunManagedMethodByPath" SequenceNo="73">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_TotalBondPayment_#level#_#Id#" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="TotalBondPayment_#level#_#Id#" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
    <Action ActionCode="StatedAmountPerNoteAfterPayment_#level#_#Id#" ActionDisplayName="#{ShortName}#支付后每份金额" FunctionName="RunManagedMethodByPath" SequenceNo="74">
      <Parameter Name="IsCashFlowDisplay" SessionParameterName="" Value="true" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="InputType" SessionParameterName="" Value="Calculated" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="ActionType" SessionParameterName="" Value="CashFlow" DataType="String" Usage="CashFlow" IsConfigurable="false" />
      <Parameter Name="AssemblyPath" SessionParameterName="" Value="" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="TypeName" SessionParameterName="" Value="EquationProvider.CashFlowEquationProvider" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="MethodName" SessionParameterName="" Value="EC_StatedAmountPerNoteAfterPayment_#level#_#Id#" DataType="String" Usage="Task" IsConfigurable="false" />
      <Parameter Name="CurrentPosition" SessionParameterName="CurrentPosition" Value="0" DataType="Int16" Usage="" IsConfigurable="false" />
      <Parameter Name="CashFlowName" SessionParameterName="" Value="StatedAmountPerNoteAfterPayment_#level#_#Id#" DataType="String" Usage="" IsConfigurable="false" />
    </Action>
	
	 </Actions>
     <Methods>
		<main>
      <Parameters>
        <Parameter Name="StatedAmountPerNotePriorPayment" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="StatedAmountPerNotePriorPayment_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
        <Parameter Name="PrincipalPaymentPerNote" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="PrincipalPaymentPerNote_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_StatedAmountPerNoteAfterPayment_#level#_#Id#">
        return Math.Max(StatedAmountPerNotePriorPayment-PrincipalPaymentPerNote,0);
      </Query>
      <Presentation />
    </main>
		<main>
      <Parameters>
        <Parameter Name="Principal" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Principal_Paid_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
        <Parameter Name="Coupon" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Interest_Paid_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_TotalBondPayment_#level#_#Id#">
        return Principal + Coupon;
      </Query>
      <Presentation />
    </main> 
         <main>
      <Parameters>
        <Parameter Name="Principal" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="PrincipalPaymentPerNote_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
        <Parameter Name="Coupon" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="CouponPaymentPerNote_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_TotalPaymentPerNote_#level#_#Id#">
        return Principal + Coupon;
      </Query>
      <Presentation />
    </main>
     <main>
      <Parameters>
        <Parameter Name="NumberOfNotes" SessionParameterName="NumberOfNotes_#level#_#Id#" Value="" DataType="double" Usage="CashFlow" />
        <Parameter Name="Paid" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Principal_Paid_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
        <Parameter Name="Precision" SessionParameterName="PrincipalPrecision" Value="" DataType="double" Usage="CashFlow" />
      </Parameters>
      <Query name="EC_PrincipalPaymentPerNote_#level#_#Id#"> 
        return Math.Round(Paid / NumberOfNotes,(int)Precision, MidpointRounding.AwayFromZero);
      </Query>
      <Presentation />
    </main>
	<main>
      <Parameters>
        <Parameter Name="NumberOfNotes" SessionParameterName="NumberOfNotes_#level#_#Id#" Value="" DataType="double" Usage="CashFlow" />
        <Parameter Name="Paid" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Interest_Paid_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
        <Parameter Name="Precision" SessionParameterName="InterestPrecision" Value="" DataType="double" Usage="CashFlow" />
      </Parameters>
      <Query name="EC_CouponPaymentPerNote_#level#_#Id#">
        return Math.Round(Paid / NumberOfNotes,(int)Precision, MidpointRounding.AwayFromZero);
      </Query>
      <Presentation />
    </main>
		  <main>
      <Parameters>
        <Parameter Name="Interest_Due" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Interest_Due_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
        <Parameter Name="AllocationAmount" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Interest_Paid_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_InterestLeftover_#level#_#Id#">
        return Math.Max(Interest_Due - AllocationAmount,0);
      </Query>
      <Presentation />
    </main>
		 <main>
      <Parameters>
        <Parameter Name="OpeningInvestedAmount" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="OpeningBalance_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
        <Parameter Name="AllocationAmount" SessionParameterName="" Value="" DataType="double" Usage="CashFlow">
          <Field Name="Principal_Paid_#level#_#Id#">
            <Position>CurrentPosition</Position>
          </Field>
        </Parameter>
      </Parameters>
      <Query name="EC_ClosingInvestedAmount_#level#_#Id#">
        return Math.Max(OpeningInvestedAmount - AllocationAmount,0);
      </Query>
      <Presentation />
    </main>
	  </Methods>
</Tool>